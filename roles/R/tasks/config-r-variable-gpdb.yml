#
- name: Comment out the lines of R variables generated by DataScience packages or others
  become: true
  replace:
    path: /usr/local/greenplum-db/greenplum_path.sh
    regexp: '^(?!#)(.*GPHOME/ext/R-.*)'
    replace: '#\1'

#
- name: Add lines of R variables into "$GPHOME"/greenplum_path.sh
  become: true
  lineinfile:
    dest: /usr/local/greenplum-db/greenplum_path.sh
    line: "{{ item }}"
    state: present
  with_items:
    - "export R_HOME_DIR=/opt/R/{{ r_major_version }}.{{ r_minor_version }}.{{ r_patch_version }}"
    - "export LD_LIBRARY_PATH=$R_HOME_DIR/lib:$LD_LIBRARY_PATH"
    - "export PATH=$R_HOME_DIR/bin:$PATH"

#
- name: Recursively change ownership of R libraary directory for gpadmin user
  become: yes
  file:
    path: /opt/R/{{ r_major_version }}.{{ r_minor_version }}.{{ r_patch_version }}/lib/R/{{ item }}
    state: directory
    recurse: yes
    owner: gpadmin
    group: gpadmin
  with_items:
    - "doc"
    - "library"
  when: with_gpdb == true
